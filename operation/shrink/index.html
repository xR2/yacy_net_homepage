<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="keywords" content="YaCy Suchmaschine search engine spider harvester indexer p2p peer network open free download software development">
    <meta name="copyright" content="Michael Peter Christen">

    <meta name="description" content="YaCy P2P - Decentralized Search Engine">
    <meta name="author" content="Michael Christen">
    <link rel="canonical" href="https://yacy.net/operation/shrink/">
    <link rel="../../img/favicon.ico">

    
    <title>Shrink Debian by removing all graphical features to turn it into a headless server - YaCy</title>
    

    <link href="../../css/hack.min.css" rel="stylesheet">
    <link href="../../css/latolatinfonts.css" rel="stylesheet">
    <link href="../../css/bootstrap-custom.css" rel="stylesheet">
    <link href="../../css/base.css" rel="stylesheet">
    <link href="../../css/cinder.css" rel="stylesheet">
    <link href="../../css/highlight.css" rel="stylesheet">
    <!-- <link href="../../css/latostyle.css" rel="stylesheet">-->

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
            <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
            <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
        <![endif]-->

     
</head>

<body>
    <script src="../../js/jquery.min.js"></script>
    <script src="../../js/fontawesome-all.js"></script>
    <script src="../../js/bootstrap-3.0.3.min.js"></script>
    <script src="../../js/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script>var base_url = "../.."</script>
    
    <script src="../../js/base.js"></script>
    <script src="../../search/main.js"></script>

    <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->

            <a class="navbar-brand" href="../..">
<!--YaCy-->
<img src="../img/YaCyLogo2011_60.png" height="40">
</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                
                
                    <li >
                        <a href="../..">Home</a>
                    </li>
                
                
                
                    <li >
                        <a href="../../demonstration_tutorial_screenshot/">Demo</a>
                    </li>
                
                
                
                    <li >
                        <a href="../../download_installation/">Download</a>
                    </li>
                
                
                
                    <li >
                        <a href="../../faq/">FAQ</a>
                    </li>
                
                
                </ul>

            <ul class="nav navbar-nav navbar-right">
		    <li>
                        <a href="https://searchlab.eu">
                           Forum
                        </a>
                    </li>
                    <li>
                        <a href="https://github.com/yacy/yacy_search_server">
                            <i class="fab fa-github"></i> GitHub
                        </a>
                    </li>
                    <li>
                        <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                            <i class="fas fa-search"></i> Search
                        </a>
                    </li>

            </ul>
        </div>
    </div>
</div>

    <div class="container">
        
        
        <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="first-level active"><a href="#shrink-debian-by-removing-all-graphical-features-to-turn-it-into-a-headless-server">Shrink Debian by removing all graphical features to turn it into a headless server</a></li>
            <li class="second-level"><a href="#delete-packages-for-graphics">Delete Packages for Graphics</a></li>
                
            <li class="second-level"><a href="#orphaned-package-removal">Orphaned Package Removal</a></li>
                
            <li class="second-level"><a href="#remove-large-packages">Remove Large Packages</a></li>
                
            <li class="second-level"><a href="#remove-software-with-large-runtime">Remove Software with Large Runtime</a></li>
                
            <li class="second-level"><a href="#remove-old-kernel-modules">Remove Old Kernel Modules</a></li>
                
            <li class="second-level"><a href="#search-for-installed-packages">Search for installed packages</a></li>
                
            <li class="second-level"><a href="#prepare-for-tiny-virtualbox-ova-appliance-dumps">Prepare for tiny VirtualBox ova Appliance Dumps</a></li>
                
                <li class="third-level"><a href="#reduce-data">Reduce Data</a></li>
                <li class="third-level"><a href="#wipe-out-empty-space">Wipe Out Empty Space</a></li>
                <li class="third-level"><a href="#shrink-virtual-disk-image">Shrink Virtual Disk Image</a></li>
    </ul>
</div></div>
        <div class="col-md-9" role="main">

<h1 id="shrink-debian-by-removing-all-graphical-features-to-turn-it-into-a-headless-server">Shrink Debian by removing all graphical features to turn it into a headless server</h1>
<p>For YaCy, no online graphical interface is needed. Because YaCy starts automatically with a headless-option, only a headless java (i.e. package openjdk-7-jre-headless) is required and we can safely remove all graphics drivers from debian.</p>
<h2 id="delete-packages-for-graphics">Delete Packages for Graphics</h2>
<p>As root, simply do</p>
<pre><code>apt-get remove --purge libx11-6
</code></pre>
<p>followed by a clean-up</p>
<pre><code>apt-get autoremove --purge
sudo apt-get clean
</code></pre>
<p>This will remove many packages, but to get debian really clean, remove unused packages as well. This should include all non-headless applications. Some can be discovered automatically, see next section.</p>
<h2 id="orphaned-package-removal">Orphaned Package Removal</h2>
<p>Because some unused packages do not necessarily have dependencies to removed packages, we need a tool to discover such orphaned packages:</p>
<pre><code>apt-get install deborphan
deborphan
deborphan --guess-all
</code></pre>
<p>You can easily remove all packages which deborphan reports with</p>
<pre><code>apt-get remove --purge `deborphan`
apt-get remove --purge `deborphan --guess-all`
apt-get autoremove --purge
</code></pre>
<p>Repeat this until no more packages are deleted, then do a</p>
<pre><code>apt-get clean
</code></pre>
<h2 id="remove-large-packages">Remove Large Packages</h2>
<p>This goes beyond removal of non-headless software but might be useful to further shrink debian to get away large and unused software. You can easily discover large packages with</p>
<pre><code>dpkg-query -W --showformat='${Installed-Size} ${Package} [depends: ${Depends}]\n' | sort -n 
</code></pre>
<p>which lists each package with occupied kilobytes, the package name and the dependencies for that package. A good starting point is the removal of large packages with many dependencies because chances are high that then again orphaned packages appear which can be removed with the 'Orphaned Package Removal' from last section.</p>
<h2 id="remove-software-with-large-runtime">Remove Software with Large Runtime</h2>
<p>Some software on your server may consume a lot of CPU time. If some of these processes are of no use for you, you can delete them. To discover such processes, run</p>
<pre><code>top -bn1 | grep root | sort -k11
</code></pre>
<p>Whenever you removed more packages, run the 'Orphaned Package Removal' process again.</p>
<h2 id="remove-old-kernel-modules">Remove Old Kernel Modules</h2>
<p>Kernel modules take up a large disk space and can easily be removed. To ensure that you are doing the right thing, first check which kernel you are running with</p>
<pre><code>uname -r
</code></pre>
<p>Then you can look for the modules which are stored with</p>
<pre><code>ls /lib/modules
</code></pre>
<p>Finally remove the modules, which are not identical to the one as discovered with uname -r using i.e.</p>
<pre><code>apt-get remove --purge 3.5.0-17-generic
</code></pre>
<p>and so on for all old kernel. This will free about 100MB of disk space for each kernel.</p>
<h2 id="search-for-installed-packages">Search for installed packages</h2>
<p>Whenever you want to remove a package, you must know the name of that package. The package names of all installed packages can be listed with</p>
<pre><code>dpkg --get-selections
</code></pre>
<p>This can be useful i.e. if you want to see if you have two versions of the same tool, i.e.</p>
<pre><code>dpkg --get-selections *jre*
</code></pre>
<p>may show you that you have installed jre-6 and jre-7, so you can remove one of them. You can also remove all linux source headers files, search for <em>headers</em> which will free a large amount of space.</p>
<h2 id="prepare-for-tiny-virtualbox-ova-appliance-dumps">Prepare for tiny VirtualBox ova Appliance Dumps</h2>
<p>To further shrink the debian installation (i.e. to prepare an appliance dump in VirtualBox), it makes sense to remove more never-used applications and data.</p>
<h3 id="reduce-data">Reduce Data</h3>
<p>http://wiki.debian.org/ReduceDebian has some hints to reduce debian, this is what removes most of the remaining data:</p>
<pre><code>rm -Rf /usr/share/locale
rm -Rf /usr/share/doc
rm -Rf /usr/share/man
</code></pre>
<p>As a very last step you can also delete the package lists</p>
<pre><code>rm -r /var/lib/apt/lists
</code></pre>
<p>.. which will free about 100MB of disk space. The lists directory is recreated the next time you run apt-get update.</p>
<h3 id="wipe-out-empty-space">Wipe Out Empty Space</h3>
<p>When you export a virtual machine to a ova Appliance dump, the virtual disk is compressed. To enhance this process, it is necessary to zero all empty disk space. The easiest way to do this is:</p>
<pre><code>dd if=/dev/zero of=/emptyspace
rm -rf /emptyspace
</code></pre>
<h3 id="shrink-virtual-disk-image">Shrink Virtual Disk Image</h3>
<p>VirtualBox has some command-line tools, this is what you would like to do to reduce the disk size after you wiped out the empty space:</p>
<pre><code>VBoxManage modifyhd --compact my_disk_image.vdi
</code></pre>
<p>In case that you created the virtual machine from a ova dump, you probably don't have a vdi file but a vmdk file. This cannot be shrinked with VBoxManage, but you can create a vdi file out from the vmdk which can be shrinked then:</p>
<pre><code>VBoxManage clonehd --format vdi my_disk_image.vmdk my_disk_image.vdi
</code></pre>
<p>When doing this, you must assign the new disk to the virtual machine in the VirtualBox GUI. However, a shrinked vmdk file is mostly smaller than a shrinked vdi file, therefore it does not make sense to apply this on an already shrinked appliance.</p></div>
        
        
    </div>

    <br/><br/>
    <footer class="col-md-12 text-center" style="background-color:#000000;" >
<div class="container" style="text-align:left; font-size:13px; padding-top:30px;">
      <div class="row">
        <div class="col-md-3" style="padding-left:15px; padding-right:15px;">
          <h3>Products</h3>
          <p>YaCy is both the name of a project and the name of a software. Our main 'product' (it's free-software) is the YaCy Search Server.</p>
        </div>
        <div class="col-md-3" style="padding-right:15px;">
          <h3>GDPR Compliance</h3>
          <p>YaCy has a strong connection to privacy-aware tools. As such it does not collect personalized data. It also has no 'phoning-home' integrated. This web page does not use cookies. However, linked services may have cookies.</p>
       </div>
        <div class="col-md-3" style="padding-right:15px;">
          <h3>Company</h3>
          <p>The brand 'YaCy' is owned in a private company. While the software YaCy is a non-profit, free software we also provide consulting for YaCy and search-related business topics. To run the non-profit YaCy project we heavily depend on community support either as contribution to our software and documentation or on donations. Please donate! For a contact please see&nbsp;
<a href="../impressum/">Impressum</a>


</p>
        </div>
        <div class="col-md-3" style="padding-right:15px;">
          <h3>Follow Us</h3>
          <ul>
	    <li>Twitter: <a href="https://twitter.com/yacy_search">@yacy_search</a></li>
	    <li>Youtube: <a href="https://www.youtube.com/YaCyTutorials">YaCyTutorials</a></li>
	    <li>GitHub: <a href="https://github.com/yacy">yacy_search_server</a></li>
	    <li>Searchlab Forum: <a href="https://searchlab.eu/">YaCy Forum</a></li>
	  </ul>
        </div>
      </div>
</div>


        
        <p>
        <!--
	<small>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p></small>
	-->

        
        
    </footer>
    

    <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form>
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>
    </body>

</html>